const postData=async(url,data={},nonce="")=>(await fetch(url,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"X-WP-Nonce":nonce,"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(data)})).json(),isInViewport=element=>{const rect=element.getBoundingClientRect();return rect.bottom>0&&rect.right>0&&rect.left<(window.innerWidth||document.documentElement.clientWidth)&&rect.top<(window.innerHeight||document.documentElement.clientHeight)};class LazyEmbeds{videoIds;embeds;lazyEnabled;lazyHtmlVideos;constructor(){this.videoIds=[],this.embeds=document.getElementsByClassName("sllv-embed"),this.lazyEnabled=!0,this.lazyHtmlVideos=!0,window.addEventListener("scroll",()=>this.lazyLoadHtmlVideos()),window.addEventListener("resize",()=>this.lazyLoadHtmlVideos()),window.addEventListener("load",()=>this.lazyLoadHtmlVideos()),this.embeds&&(window.addEventListener("scroll",()=>this.lazyLoadThumbnails()),window.addEventListener("resize",()=>this.lazyLoadThumbnails()),window.addEventListener("load",()=>this.lazyLoadThumbnails()),this.initLazyEmbeds())}lazyLoadHtmlVideos(){if(!this.lazyHtmlVideos)return;const lazyHTML5Videos=document.querySelectorAll(".sllv-lazy-video");lazyHTML5Videos.forEach(video=>{isInViewport(video)&&video.dataset.src&&(video.src=video.dataset.src,video.classList.remove("sllv-lazy-video"))}),lazyHTML5Videos.length<1&&(this.lazyHtmlVideos=!1)}lazyLoadThumbnails(){if(!this.lazyEnabled)return;const lazyThumbnails=document.querySelectorAll(".sllv-lazy");lazyThumbnails.forEach(thumbnail=>{isInViewport(thumbnail)&&thumbnail.dataset.bg&&(thumbnail.style.backgroundImage=`url(${thumbnail.dataset.bg})`,thumbnail.classList.remove("sllv-lazy"))}),lazyThumbnails.length<1&&(this.lazyEnabled=!1)}initLazyEmbeds(){Array.from(this.embeds).forEach(embed=>{const videoId=embed.getAttribute("data-embed"),isPlaylist=embed.getAttribute("data-playlist"),isYoutube=embed.classList.contains("sllv-youtube");this.addClickEvents(embed,videoId,isYoutube,isPlaylist),this.videoIds.includes(videoId)||(this.loadVideoThumbnail(videoId,isYoutube,isPlaylist),this.videoIds.push(videoId))})}addClickEvents(embed,videoId,isYoutube,isPlaylist){embed.addEventListener("click",()=>{embed.innerHTML=this.generateIframeMarkup(videoId,isYoutube,isPlaylist)})}async loadVideoThumbnail(videoId,isYoutube,isPlaylist){if(!isYoutube)return;let thumbnails;try{thumbnails=await postData(`${sllv.rest}sllv/youtube`,{videoId,isPlaylist,pageId:sllv.pageId},sllv.nonce)}catch{return}if(!thumbnails||thumbnails.length<1||thumbnails.low===void 0)return;const allVideosWithId=document.querySelectorAll(`[data-embed="${videoId}"]`);Array.from(allVideosWithId).forEach(item=>{let thumbnail=thumbnails.low;window.outerWidth<780&&window.outerWidth>520&&(thumbnail=thumbnails.mid),window.outerWidth>780&&(thumbnail=thumbnails.high),isInViewport(item)?(item.classList.remove("sllv-lazy"),item.style.backgroundImage=`url(${thumbnail})`):item.dataset.bg=thumbnail})}generateIframeMarkup(videoId,isYoutube=!0,isPlaylist="",noCookie=!0){let domain="www.youtube.com/embed";const list=isPlaylist?`&list=${isPlaylist}`:"";return noCookie&&(domain="www.youtube-nocookie.com/embed"),isYoutube?`<iframe src="https://${domain}/${videoId}?wmode=opaque&autohide=1&autoplay=1&enablejsapi=1&modestbranding=1${list}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; web-share" allowfullscreen></iframe>`:`<iframe src="https://player.vimeo.com/video/${videoId}?h=1ac4fd9fb4&title=0&byline=0&portrait=0&wmode=opaque&autohide=1&autoplay=1&enablejsapi=1&modestbranding=1" title="Vimeo video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; web-share" allowfullscreen></iframe>`}}new LazyEmbeds;
